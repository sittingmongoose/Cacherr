version: '3.8'

services:
  plexcache-ultra:
    build: .
    container_name: plexcache-ultra
    restart: unless-stopped
    ports:
      - "5443:5443"
    environment:
      - PLEX_URL=${PLEX_URL}
      - PLEX_TOKEN=${PLEX_TOKEN}
      - CACHE_DIR=${CACHE_DIR:-/mnt/cache}
      - REAL_SOURCE=${REAL_SOURCE:-/mnt/user}
      - PLEX_SOURCE=${PLEX_SOURCE:-/media}
      - CACHE_DESTINATION=${CACHE_DESTINATION:-}
      - ADDITIONAL_SOURCES=${ADDITIONAL_SOURCES:-}
      - ADDITIONAL_PLEX_SOURCES=${ADDITIONAL_PLEX_SOURCES:-}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - WEBHOOK_URL=${WEBHOOK_URL:-}
      - NOTIFICATION_TYPE=${NOTIFICATION_TYPE:-webhook}
      - MAX_CONCURRENT_MOVES_CACHE=${MAX_CONCURRENT_MOVES_CACHE:-5}
      - MAX_CONCURRENT_MOVES_ARRAY=${MAX_CONCURRENT_MOVES_ARRAY:-2}
      - MAX_CONCURRENT_LOCAL_TRANSFERS=${MAX_CONCURRENT_LOCAL_TRANSFERS:-5}
      - MAX_CONCURRENT_NETWORK_TRANSFERS=${MAX_CONCURRENT_NETWORK_TRANSFERS:-2}
      - NUMBER_EPISODES=${NUMBER_EPISODES:-5}
      - DAYS_TO_MONITOR=${DAYS_TO_MONITOR:-99}
      - WATCHLIST_TOGGLE=${WATCHLIST_TOGGLE:-true}
      - WATCHLIST_EPISODES=${WATCHLIST_EPISODES:-1}
      - WATCHLIST_CACHE_EXPIRY=${WATCHLIST_CACHE_EXPIRY:-6}
      - WATCHED_MOVE=${WATCHED_MOVE:-true}
      - WATCHED_CACHE_EXPIRY=${WATCHED_CACHE_EXPIRY:-48}
      - USERS_TOGGLE=${USERS_TOGGLE:-true}
      - EXIT_IF_ACTIVE_SESSION=${EXIT_IF_ACTIVE_SESSION:-false}
      - COPY_TO_CACHE=${COPY_TO_CACHE:-false}
      - DELETE_FROM_CACHE_WHEN_DONE=${DELETE_FROM_CACHE_WHEN_DONE:-true}
      - USE_SYMLINKS_FOR_CACHE=${USE_SYMLINKS_FOR_CACHE:-true}
      - MOVE_WITH_SYMLINKS=${MOVE_WITH_SYMLINKS:-false}
      - TEST_MODE=${TEST_MODE:-false}
      - TEST_SHOW_FILE_SIZES=${TEST_SHOW_FILE_SIZES:-true}
      - TEST_SHOW_TOTAL_SIZE=${TEST_SHOW_TOTAL_SIZE:-true}
      - TEST_DRY_RUN=${TEST_DRY_RUN:-true}
      - REAL_TIME_WATCH_ENABLED=${REAL_TIME_WATCH_ENABLED:-false}
      - REAL_TIME_WATCH_CHECK_INTERVAL=${REAL_TIME_WATCH_CHECK_INTERVAL:-30}
      - REAL_TIME_WATCH_AUTO_CACHE_ON_WATCH=${REAL_TIME_WATCH_AUTO_CACHE_ON_WATCH:-true}
      - REAL_TIME_WATCH_CACHE_ON_COMPLETE=${REAL_TIME_WATCH_CACHE_ON_COMPLETE:-true}
      - REAL_TIME_WATCH_RESPECT_EXISTING_RULES=${REAL_TIME_WATCH_RESPECT_EXISTING_RULES:-true}
      - REAL_TIME_WATCH_MAX_CONCURRENT_WATCHES=${REAL_TIME_WATCH_MAX_CONCURRENT_WATCHES:-10}
      - REAL_TIME_WATCH_REMOVE_FROM_CACHE_AFTER_HOURS=${REAL_TIME_WATCH_REMOVE_FROM_CACHE_AFTER_HOURS:-24}
      - REAL_TIME_WATCH_RESPECT_OTHER_USERS_WATCHLISTS=${REAL_TIME_WATCH_RESPECT_OTHER_USERS_WATCHLISTS:-true}
      - REAL_TIME_WATCH_EXCLUDE_INACTIVE_USERS_DAYS=${REAL_TIME_WATCH_EXCLUDE_INACTIVE_USERS_DAYS:-30}
      - TRAKT_ENABLED=${TRAKT_ENABLED:-false}
      - TRAKT_CLIENT_ID=${TRAKT_CLIENT_ID:-}
      - TRAKT_CLIENT_SECRET=${TRAKT_CLIENT_SECRET:-}
      - TRAKT_TRENDING_MOVIES_COUNT=${TRAKT_TRENDING_MOVIES_COUNT:-10}
      - TRAKT_CHECK_INTERVAL=${TRAKT_CHECK_INTERVAL:-3600}
      - WEB_PORT=${PORT:-5443}
      - PORT=${PORT:-5443}
      - WEB_DEBUG=${DEBUG:-false}
      - ENABLE_SCHEDULER=${ENABLE_SCHEDULER:-false}
    volumes:
      - ${CACHE_DIR:-/mnt/cache}:${CACHE_DIR:-/mnt/cache}:rw
      - ${REAL_SOURCE:-/mnt/user}:${REAL_SOURCE:-/mnt/user}:rw
      - ${PLEX_SOURCE:-/media}:${PLEX_SOURCE:-/media}:ro
      - ./data:/app/data:rw
      - ./logs:/app/logs:rw
    networks:
      - plexcache-network

networks:
  plexcache-network:
    driver: bridge
